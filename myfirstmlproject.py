# -*- coding: utf-8 -*-
"""MyFirstMLproject.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ERURLdG-asyh1Z8ZtsZYPMaggGRpBrjP
"""

import pandas as pd

teams = pd.read_csv("teams.csv")

teams

teams = teams[["team","country","year","athletes","age","prev_medals","medals"]]

teams

teams.corr()["medals"]

import seaborn as sns

sns.lmplot(x="athletes" , y="medals" , data=teams , fit_reg=True ,ci=None)

sns.lmplot(x="prev_medals" , y="medals" , data=teams , fit_reg=True ,ci=None)

sns.lmplot(x="age" , y="medals" , data=teams , fit_reg=True ,ci=None)

teams.plot.hist(y="medals")

#data cleaning

teams[teams.isnull().any(axis=1)]

teams = teams.dropna()

teams[teams.isnull().any(axis=1)]

train = teams[teams["year"] < 2012].copy()
test = teams[teams["year"] >= 2012].copy()

train.shape

test.shape

from sklearn.linear_model import LinearRegression

reg = LinearRegression()

predictors = ["athletes","prev_medals"]
target = "medals"

reg.fit(train[predictors],train["medals"])

predictions = reg.predict(test[predictors])



test["predictions"] = predictions

test

test.loc[test["predictions"] < 0 , "predictions"] = 0

test

test["predictions"] = test["predictions"].round()

test

from sklearn.metrics import mean_absolute_error

error = mean_absolute_error(test["medals"],test["predictions"])

error

teams.describe()["medals"]

test[test["team"] == "USA"]

test[test["team"] == "IND"]

errors = (test["medals"] - test["predictions"]).abs()

errors

error_by_team = errors.groupby(test["team"]).mean()

error_by_team

medals_by_team = test["medals"].groupby(test["team"]).mean()

error_ratio = error_by_team / medals_by_team

error_ratio

error_ratio[~pd.isnull(error_ratio)]

import numpy as np
error_ratio = error_ratio[np.isfinite(error_ratio)]

error_ratio

error_ratio.plot.hist(x="medals")

error_ratio.sort_values()

#i can add more predictors
# try different models - random forest